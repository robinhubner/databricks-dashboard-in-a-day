resources:
  jobs:
    sunny_bay_roastery_job:
      name: sunny_bay_roastery
      trigger:
        periodic:
          interval: 1
          unit: DAYS

      tasks:
        - task_key: init_bronze_data
          environment_key: default
          spark_python_task:
            python_file: ./bronze/main.py
            parameters:
            - "--catalog=${var.catalog}"

        - task_key: run_pipeline
          depends_on:
            - task_key: init_bronze_data
          pipeline_task:
            pipeline_id: ${resources.pipelines.sunny_bay_roastery_pipeline.id}

      environments:
        - environment_key: default
          spec:
            environment_version: "4"

      schemas:
        bronze:
          name: bronze
          catalog_name: ${var.catalog}
          comment: This schema was created by Databricks Asset Bundles.
        silver:
          name: silver
          catalog_name: ${var.catalog}
          comment: This schema was created by Databricks Asset Bundles.
        gold:
          name: gold
          catalog_name: ${var.catalog}
          comment: This schema was created by Databricks Asset Bundles.

      volumes:
        raw:
          catalog_name: ${var.catalog}
          name: raw
          schema_name: bronze
